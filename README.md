# PHITSを用いた太陽電池の放射線損傷解析マニュアル

## はじめに

本マニュアルでは、PHITS（Particle and Heavy Ion Transport code System）を使用して、一般的なシリコン（Si）太陽電池に対する陽子線および電子線照射による原子あたりのはじき出し数（Displacement Per Atom, DPA）を定量的に解析する手順を説明します。

### 対象読者

- PHITSの基本的な使用方法を理解している方
- 太陽電池の放射線損傷解析に興味のある研究者・技術者

### 必要な知識

- PHITSの基本的な操作
- 入力ファイルの構造とセクションの理解
- 幾何学的構造の定義方法
- 線源設定の基本

## 1. 太陽電池の層構造モデル定義

一般的なSi太陽電池は、以下のような層構造を持ちます：

1. **カバーガラス層**（保護層）
2. **EVA接着剤層**（エチレン酢酸ビニル）
3. **SiNxアンチリフレクションコーティング層**（窒化シリコン）
4. **Si基板層**（バルク層）
5. **バックコンタクト層**（Al電極）

### 1.1 幾何学的構造の定義

PHITSでは、[Surface]セクションと[Cell]セクションを使用して幾何学的構造を定義します。

#### [Surface]セクション

各層の境界面を定義します。太陽電池をz軸方向に層状に配置する場合の例：

```
[ Surface ]
* 面番号  面記号  パラメータ
  1       PZ      -0.1        # カバーガラス下表面（z = -0.1 cm）
  2       PZ       0.0         # カバーガラス/EVA境界（z = 0.0 cm）
  3       PZ       0.05        # EVA/SiNx境界（z = 0.05 cm）
  4       PZ       0.06        # SiNx/Si境界（z = 0.06 cm）
  5       PZ       0.36        # Si/Al境界（z = 0.36 cm）
  6       PZ       0.40        # Al下表面（z = 0.40 cm）
  10      PX      -5.0         # x方向の境界
  11      PX       5.0
  20      PY      -5.0         # y方向の境界
  21      PY       5.0
```

#### [Cell]セクション

各層の領域を定義します：

```
[ Cell ]
* セル番号  物質番号  密度    領域定義
  1         0         0        -10 10 -20 20 -1 2    # 真空領域（外側）
  2         1         2.5      -10 10 -20 20 -1 2    # カバーガラス層（z: -0.1 ~ 0.0 cm）
  3         2         0.95     -10 10 -20 20 2 3     # EVA層（z: 0.0 ~ 0.05 cm）
  4         3         3.1       -10 10 -20 20 3 4     # SiNx層（z: 0.06 ~ 0.06 cm）
  5         4         2.33      -10 10 -20 20 4 5     # Si基板層（z: 0.06 ~ 0.36 cm）
  6         5         2.7       -10 10 -20 20 5 6    # Al電極層（z: 0.36 ~ 0.40 cm）
```

**注意**: 領域定義は「面番号の符号」で領域を指定します。面のマイナス側（内側）を指定する場合は負の符号を使用します。

### 1.2 材料定義

[Material]セクションで各層の材料組成を定義します：

```
[ Material ]
* 物質番号  元素記号  原子数密度比または重量比
  1          O        2        # カバーガラス（SiO2）
            Si        1
  2          C        4        # EVA（C4H6O2の簡略化）
            H        6
            O        2
  3          Si        3       # SiNx（Si3N4）
            N        4
  4          Si        1        # 純粋なシリコン
  5          Al        1        # アルミニウム
```

**密度の指定**: 各材料の密度は[Cell]セクションで指定するか、[Material]セクションで指定できます。

## 2. 放射線源の設定

### 2.1 陽子線源の設定

太陽電池の表面側から均一に照射するため、面上分布ソース（s-type = 26）を使用します。
これにより、太陽電池の表面（カバーガラス上表面）全体から均一に粒子が発生します。

[Source]セクションで陽子線源を定義します：

```
[ Source ]
totfact = 1.0e10
<source> = 1.0
s-type = 26             # 面上分布ソース
suf = 1                 # 面番号1（カバーガラス上表面、z = -0.1 cmの面）
cut = 10 -11 20 -21     # 面上の領域制限（x: -5.0~5.0 cm, y: -5.0~5.0 cm）
proj = proton           # 陽子
dir = 1.0               # 面の法線方向（垂直入射）
e-type = 0              # 単一エネルギー
eg0 = 10.0              # エネルギー [MeV]
```

**パラメータの説明**:
- `suf = 1`: 面番号1（`PZ -0.1`で定義されたカバーガラス上表面）から粒子を発生
- `cut = 10 -11 20 -21`: 面上の領域を制限
  - 面10（`PX -5.0`）のプラス側（x > -5.0）
  - 面11（`PX 5.0`）のマイナス側（x < 5.0）
  - 面20（`PY -5.0`）のプラス側（y > -5.0）
  - 面21（`PY 5.0`）のマイナス側（y < 5.0）
- `dir = 1.0`: 面の法線方向（z方向）に垂直入射

### 2.2 電子線源の設定

電子線源も同様に面上分布ソースを使用します：

```
[ Source ]
totfact = 1.0e10
<source> = 1.0
s-type = 26             # 面上分布ソース
suf = 1                 # 面番号1（カバーガラス上表面、z = -0.1 cmの面）
cut = 10 -11 20 -21     # 面上の領域制限（x: -5.0~5.0 cm, y: -5.0~5.0 cm）
proj = electron         # 電子
dir = 1.0               # 面の法線方向（垂直入射）
e-type = 0              # 単一エネルギー
eg0 = 1.0               # エネルギー [MeV]
```

### 2.3 エネルギー分布の設定

連続的なエネルギー分布を設定する場合：

```
e-type = 1              # 積分型連続エネルギー分布
eg1 = 0.1               # 最小エネルギー [MeV]
eg2 = 10.0              # 最大エネルギー [MeV]
nm = -100               # エネルギー群数（負の値で対数分割）
```

### 2.4 フルエンスの設定

`totfact`パラメータで線源強度を設定します。フルエンス（粒子数/cm²）を指定する場合：

```
totfact = 1.0e10        # 1.0×10^10 粒子/cm²
```

## 3. DPA計算の設定

### 3.1 [T-DPA]セクションの基本設定

DPAを計算するには、[T-DPA]セクションを使用します：

```
[ T-DPA ]
mesh = reg              # 領域メッシュ
reg = 2 3 4 5 6         # 各層の領域番号
part = all              # 全粒子をタリー
axis = reg              # 領域ごとのDPAを出力
file = dpa.out          # 出力ファイル名
unit = 1                # DPA[x1.E-24/source]
output = dpa            # DPAの出力
idpa = 0                # NRT-dpa（非熱的再結合補正なし）
```

### 3.2 深さ方向のDPA分布

深さ方向（z方向）のDPA分布を取得する場合：

```
[ T-DPA ]
mesh = xyz               # xyzメッシュ
part = all
axis = z                # z方向の分布
file = dpa_z.out
unit = 1
output = dpa
idpa = 0
```

xyzメッシュの定義：

```
[ T-DPA ]
mesh = xyz
x-type = 1              # 線形メッシュ
x0 = -5.0               # x最小値 [cm]
x1 = 5.0                # x最大値 [cm]
nx = 1                  # x方向分割数
y-type = 1
y0 = -5.0
y1 = 5.0
ny = 1
z-type = 1              # z方向の深さ分布
z0 = -0.1               # z最小値 [cm]
z1 = 0.40               # z最大値 [cm]
nz = 50                 # z方向分割数（細かく分割）
```

### 3.3 DPAの種類

`idpa`パラメータでDPAの種類を選択できます：

- `idpa = 0`（デフォルト）: NRT-dpa（欠陥の非熱的再結合補正を考慮しない）
- `idpa = 1`: arc-dpa（欠陥の非熱的再結合補正を考慮する）

### 3.4 単位の設定

`unit`パラメータで出力単位を設定：

- `unit = 1`: DPA[x1.E-24/source]（デフォルト）
- `unit = 2`: DPA[1/source]

## 4. 完全な入力ファイル例

### 4.1 陽子線照射用入力ファイル

```
[ Title ]
Solar Cell Proton Irradiation DPA Analysis

[ Parameters ]
icntl = 0
maxcas = 1000000
itall = 0

[ Source ]
totfact = 1.0e10
<source> = 1.0
s-type = 26             # 面上分布ソース
suf = 1                 # 面番号1（カバーガラス上表面）
cut = 10 -11 20 -21     # 面上の領域制限（太陽電池の表面領域）
proj = proton           # 陽子
dir = 1.0               # 面の法線方向（垂直入射）
e-type = 0              # 単一エネルギー
eg0 = 10.0              # エネルギー [MeV]

[ Material ]
1  O  2
   Si  1
2  C  4
   H  6
   O  2
3  Si  3
   N  4
4  Si  1
5  Al  1

[ Surface ]
1  PZ  -0.1
2  PZ   0.0
3  PZ   0.05
4  PZ   0.06
5  PZ   0.36
6  PZ   0.40
10 PX  -5.0
11 PX   5.0
20 PY  -5.0
21 PY   5.0

[ Cell ]
1  0  0  -10 11 -20 21 -1 2
2  1  2.5  -10 11 -20 21 -1 2
3  2  0.95  -10 11 -20 21 2 3
4  3  3.1  -10 11 -20 21 3 4
5  4  2.33  -10 11 -20 21 4 5
6  5  2.7  -10 11 -20 21 5 6

[ T-DPA ]
mesh = xyz
part = all
axis = z
file = dpa_proton.out
unit = 1
output = dpa
idpa = 0
x-type = 1
x0 = -5.0
x1 = 5.0
nx = 1
y-type = 1
y0 = -5.0
y1 = 5.0
ny = 1
z-type = 1
z0 = -0.1
z1 = 0.40
nz = 50

[ END ]
```

### 4.2 電子線照射用入力ファイル

陽子線用の入力ファイルと同様ですが、[Source]セクションを以下のように変更：

```
[ Source ]
totfact = 1.0e10
<source> = 1.0
s-type = 26             # 面上分布ソース
suf = 1                 # 面番号1（カバーガラス上表面）
cut = 10 -11 20 -21     # 面上の領域制限（太陽電池の表面領域）
proj = electron         # 電子
dir = 1.0               # 面の法線方向（垂直入射）
e-type = 0              # 単一エネルギー
eg0 = 1.0               # エネルギー [MeV]
```

## 5. 実行方法

### 5.1 コマンドライン実行

Windowsの場合：

```cmd
phits335win.exe < input.inp
```

Linux/Macの場合：

```bash
phits < input.inp
```

### 5.2 実行時の注意点

- 計算時間は、ヒストリー数（maxcas）と幾何学的構造の複雑さに依存します
- DPA計算は比較的時間がかかる場合があります
- 統計誤差を小さくするため、十分なヒストリー数を設定してください

## 6. 結果の解析

### 6.1 出力ファイルの読み方

DPAタリーの出力ファイル（例：`dpa_proton.out`）には以下の情報が含まれます：

1. **インプットエコー**: 入力パラメータの再出力
2. **タリー結果**: 各メッシュのDPA値と統計誤差
3. **グラフ情報**: ANGELで可視化するための情報

### 6.2 層ごとのDPA取得

`axis = reg`で領域メッシュを使用した場合、各層（領域）ごとの平均DPAが出力されます。

### 6.3 深さ方向のDPA分布

`axis = z`でxyzメッシュを使用した場合、深さ方向（z方向）のDPA分布が出力されます。これにより、各層でのDPAの変化を確認できます。

### 6.4 可視化

PHITS付属のANGELを使用して結果を可視化できます：

```bash
angel dpa_proton.out
```

または、出力ファイルを直接ANGELで開きます。

## 7. トラブルシューティング

### 7.1 計算が収束しない場合

- ヒストリー数（maxcas）を増やしてください
- 統計誤差が大きい場合は、より多くのヒストリー数を設定してください

### 7.2 結果が異常な値になる場合

- 幾何学的構造の定義を確認してください（面の符号、領域定義）
- 線源の位置と方向を確認してください
- 材料の密度と組成を確認してください

### 7.3 メモリ不足エラー

- メッシュの分割数を減らしてください
- 計算する領域を限定してください

### 7.4 DPA値が0になる場合

- 線源粒子が対象領域に到達しているか確認してください
- エネルギーが低すぎて領域に到達していない可能性があります
- 線源の位置と方向を確認してください

## 8. 参考資料

### 8.1 PHITS公式サイト

- [PHITS公式サイト](https://phits.jaea.go.jp/indexj.html)
- [PHITSユーザーズマニュアル](https://phits.jaea.go.jp/manual/manualJ-html/index.html)

### 8.2 関連するマニュアルセクション

- [T-DPA]セクション: 7.10節
- [Source]セクション: 5.3節
- [Material]セクション: 5.4節
- [Cell]セクション: 5.6節
- [Surface]セクション: 5.5節

### 8.3 引用文献

PHITSを使用した論文を作成する際の引用文献については、[10.3節](#103-引用文献)を参照してください。

## 9. 補足情報

### 9.1 層の厚さの調整

実際の太陽電池の層構造に合わせて、各層の厚さを調整してください。本マニュアルの例は一般的な値を使用していますが、実際のデバイスに合わせて変更が必要です。

### 9.2 材料組成の詳細

より正確な解析を行うため、実際の材料組成を調べて[Material]セクションで正確に定義してください。

### 9.3 複数エネルギーでの解析

異なるエネルギーの陽子線・電子線での解析を行う場合、各エネルギーごとに計算を実行し、結果を比較してください。

### 9.4 フルエンス依存性

異なるフルエンスでの解析を行う場合、`totfact`パラメータを変更して計算を実行してください。

## 10. ライセンスとクレジット

### 10.1 本マニュアルのライセンス

本マニュアルは、MIT Licenseの下で公開されています。詳細は[LICENSE](LICENSE)ファイルをご参照ください。

### 10.2 PHITSに関するクレジット

本マニュアルは、**日本原子力研究開発機構（JAEA）**が開発した**PHITS（Particle and Heavy Ion Transport code System）**を使用するためのガイドです。

- **PHITS公式サイト**: https://phits.jaea.go.jp/indexj.html
- **PHITSユーザーズマニュアル**: https://phits.jaea.go.jp/manual/manualJ-html/index.html

PHITSの利用には、JAEAが定める利用規約が適用されます。PHITSを使用するには、公式サイトでのユーザー登録が必要です。詳細はPHITS公式サイトをご確認ください。

### 10.3 引用文献

PHITSを使用した研究や成果を発表する際は、以下の文献を引用してください：

**PHITSコードの引用文献**:
- T. Sato, Y. Iwamoto, S. Hashimoto, T. Ogawa, T. Furuta, S. Abe, T. Kai, Y. Matsuya, N. Matsuda, Y. Hirata, T. Sekikawa, L. Yao, P.E. Tsai, H.N. Ratliff, H. Iwase, Y. Sakaki, K. Sugihara, N. Shigyo, L. Sihver and K. Niita, "Recent improvements of the Particle and Heavy Ion Transport code System - PHITS version 3.33," J. Nucl. Sci. Technol. 61, 127-135 (2024). [オープンアクセス]

**PHITSの精度に関するベンチマーク文献**:
- Y. Iwamoto, S. Hashimoto, T. Sato, N. Matsuda, S. Kunieda, Y. Çelik, N. Furutachi and K. Niita, "Benchmark study of particle and heavy-ion transport code system using shielding integral benchmark archive and database for accelerator-shielding experiments," J. Nucl. Sci. Technol. 59, 665-675 (2022). [オープンアクセス]

### 10.4 注意事項

- **PHITSの利用規約**: PHITSの利用には、JAEAが定める利用規約が適用されます。PHITS公式サイトで最新の利用規約を確認し、遵守してください。
- **バージョン情報**: 本マニュアルはPHITS ver. 3.35を基準に作成されています。他のバージョンでは一部パラメータが異なる場合があります。最新のマニュアルを参照してください。
- **本マニュアルの内容**: 本マニュアルの内容は、PHITS公式マニュアル（manualJ-phits.pdf）を参考に作成されています。より詳細な情報や最新の機能については、PHITS公式マニュアルを参照してください。
- **保証**: 本マニュアルの内容について、正確性や完全性を保証するものではありません。実際の計算を行う際は、PHITS公式マニュアルを参照し、適切な設定を行ってください。

### 10.5 貢献

本マニュアルの改善提案やバグ報告は、GitHubのIssuesまたはPull Requestsでお願いします。

貢献方法の詳細については、[CONTRIBUTING.md](CONTRIBUTING.md)をご参照ください。

---

**注意**: 本マニュアルはPHITS ver. 3.35を基準に作成されています。他のバージョンでは一部パラメータが異なる場合があります。最新のマニュアルを参照してください。

