# PHITSを用いた太陽電池の放射線損傷解析マニュアル

## はじめに

本マニュアルでは、PHITS（Particle and Heavy Ion Transport code System）を使用して、一般的なシリコン（Si）太陽電池に対する陽子線および電子線照射による原子あたりのはじき出し数（Displacement Per Atom, DPA）を定量的に解析する手順を説明します。

### 対象読者

- PHITSの基本的な使用方法を理解している方
- 太陽電池の放射線損傷解析に興味のある研究者・技術者

### 必要な知識

- PHITSの基本的な操作
- 入力ファイルの構造とセクションの理解
- 幾何学的構造の定義方法
- 線源設定の基本

## 1. 太陽電池の層構造モデル定義

一般的なSi太陽電池は、以下のような層構造を持ちます：

1. **カバーガラス層**（保護層）
2. **EVA接着剤層**（エチレン酢酸ビニル）
3. **SiNxアンチリフレクションコーティング層**（窒化シリコン）
4. **Si基板層**（バルク層）
5. **バックコンタクト層**（Al電極）

### 1.1 幾何学的構造の定義

PHITSでは、[Surface]セクションと[Cell]セクションを使用して幾何学的構造を定義します。

#### [Surface]セクション

各層の境界面を定義します。太陽電池をz軸方向に層状に配置する場合の例：

```
[ Surface ]
* 面番号  面記号  パラメータ
  1       PZ      -0.1        # カバーガラス上表面（照射面、z = -0.1 cm）
  2       PZ       0.0         # カバーガラス/EVA境界（z = 0.0 cm）
  3       PZ       0.05        # EVA/SiNx境界（z = 0.05 cm）
  4       PZ       0.06        # SiNx/Si境界（z = 0.06 cm）
  5       PZ       0.36        # Si/Al境界（z = 0.36 cm）
  6       PZ       0.40        # Al下表面（z = 0.40 cm）
  10      PX      -5.0         # x方向の境界
  11      PX       5.0
  20      PY      -5.0         # y方向の境界
  21      PY       5.0
```

#### [Cell]セクション

各層の領域を定義します：

```
[ Cell ]
* セル番号  物質番号  密度    領域定義
  1         0         0        -10 10 -20 20 -1 2    # 真空領域（外側）
  2         1         2.5      -10 10 -20 20 -1 2    # カバーガラス層（z: -0.1 ~ 0.0 cm）
  3         2         0.95     -10 10 -20 20 2 3     # EVA層（z: 0.0 ~ 0.05 cm）
  4         3         3.1       -10 10 -20 20 3 4     # SiNx層（z: 0.06 ~ 0.06 cm）
  5         4         2.33      -10 10 -20 20 4 5     # Si基板層（z: 0.06 ~ 0.36 cm）
  6         5         2.7       -10 10 -20 20 5 6    # Al電極層（z: 0.36 ~ 0.40 cm）
```

**注意**: 領域定義は「面番号の符号」で領域を指定します。面のマイナス側（内側）を指定する場合は負の符号を使用します。

### 1.2 材料定義

[Material]セクションで各層の材料組成を定義します：

```
[ Material ]
* 物質番号  元素記号  原子数密度比または重量比
  1          O        2        # カバーガラス（SiO2）
            Si        1
  2          C        4        # EVA（C4H6O2の簡略化）
            H        6
            O        2
  3          Si        3       # SiNx（Si3N4）
            N        4
  4          Si        1        # 純粋なシリコン
  5          Al        1        # アルミニウム
```

**密度の指定**: 各材料の密度は[Cell]セクションで指定するか、[Material]セクションで指定できます。

## 2. 放射線源の設定

### 2.1 陽子線源の設定

太陽電池の表面側から均一に照射するため、面上分布ソース（s-type = 26）を使用します。
これにより、太陽電池の表面（カバーガラス上表面）全体から均一に粒子が発生します。

[Source]セクションで陽子線源を定義します：

```
[ Source ]
totfact = 1.0e10
<source> = 1.0
s-type = 26             # 面上分布ソース
suf = 1                 # 面番号1（カバーガラス上表面、照射面、z = -0.1 cm）
cut = 10 -11 20 -21     # 面上の領域制限（x: -5.0~5.0 cm, y: -5.0~5.0 cm）
proj = proton           # 陽子
dir = 1.0               # 面の法線方向（垂直入射）
e-type = 0              # 単一エネルギー
eg0 = 10.0              # エネルギー [MeV]
```

**パラメータの説明**:
- `suf = 1`: 面番号1（`PZ -0.1`で定義されたカバーガラス上表面、照射面）から粒子を発生
- `cut = 10 -11 20 -21`: 面上の領域を制限
  - 面10（`PX -5.0`）のプラス側（x > -5.0）
  - 面11（`PX 5.0`）のマイナス側（x < 5.0）
  - 面20（`PY -5.0`）のプラス側（y > -5.0）
  - 面21（`PY 5.0`）のマイナス側（y < 5.0）
- `dir = 1.0`: 面の法線方向（z方向）に垂直入射

### 2.2 電子線源の設定

電子線源も同様に面上分布ソースを使用します：

```
[ Source ]
totfact = 1.0e10
<source> = 1.0
s-type = 26             # 面上分布ソース
suf = 1                 # 面番号1（カバーガラス上表面、照射面、z = -0.1 cm）
cut = 10 -11 20 -21     # 面上の領域制限（x: -5.0~5.0 cm, y: -5.0~5.0 cm）
proj = electron         # 電子
dir = 1.0               # 面の法線方向（垂直入射）
e-type = 0              # 単一エネルギー
eg0 = 1.0               # エネルギー [MeV]
```

### 2.3 エネルギー分布の設定

連続的なエネルギー分布を設定する場合：

```
e-type = 1              # 積分型連続エネルギー分布
eg1 = 0.1               # 最小エネルギー [MeV]
eg2 = 10.0              # 最大エネルギー [MeV]
nm = -100               # エネルギー群数（負の値で対数分割）
```

### 2.4 フルエンスの設定

`totfact`パラメータで線源強度を設定します。フルエンス（粒子数/cm²）を指定する場合：

```
totfact = 1.0e10        # 1.0×10^10 粒子/cm²
```

## 3. DPA/DDD → 単位体積あたり欠陥数（cm⁻³）の求め方

**DPA（Displacements Per Atom）は「原子1個あたりの置換回数」を表すため、欠陥数密度は原子数密度 n_atoms との積で与えられます：**

```
n_defects [cm⁻³] = DPA × n_atoms
```

原子数密度は以下の式で計算されます：

```
n_atoms = (ρ/M) × N_A × (atoms per formula)
```

ここで：
- **ρ**: 密度 [g/cm³]
- **M**: モル質量 [g/mol]
- **N_A**: アボガドロ数（6.022×10²³ [1/mol]）
- **atoms per formula**: 化学式あたりの原子数

**化合物（GaAs、CIGS、SiO₂等）**では、式量中の原子数を掛けて原子密度を得ます。PHITS v3.35では`[T-DPA]`タリーに`mother`パラメータが導入されており、元素別DPAを直接出力できます（化合物の元素別検証に有用）。

### 3.1 DPAから欠陥数密度への換算（計算例）

**GaAs太陽電池の例**:

GaAsのパラメータ：
- 密度: ρ = 5.32 g/cm³
- モル質量: M = 144.64 g/mol（Ga: 69.72, As: 74.92）
- 化学式あたりの原子数: 2（GaAs）

**原子数密度の計算**:
```
n_atoms = (5.32 / 144.64) × 6.022×10²³ × 2 ≈ 4.43×10²² [atoms/cm³]
```

**欠陥数密度の計算**:

PHITSで得られたDPA値（例：DPA = 1.234×10⁻¹⁰）から欠陥数密度を計算：

```
n_defects = 1.234×10⁻¹⁰ × 4.43×10²² ≈ 5.47×10¹² [cm⁻³]
```

### 3.2 DDDから欠陥数密度への近似換算

**DDD（MeV/g）**からの近似換算（Kinchin–Pease/NRT）では、1 Frenkelペア生成に約 2Ed が必要とみなし、欠陥生成効率 η（NRT≈0.8、ARCではさらに低下）を考慮します：

```
n_defects = η × (DDD_mission[J/g] × ρ[g/cm³]) / (2Ed[J])
```

**単位換算**:
- DDD[MeV/g] × 1.602×10⁻¹³ = J/g
- Ed[eV] × 1.602×10⁻¹⁹ = J

#### NRTモデル（Norgett-Robinson-Torrensモデル）

**定義**: 放射線による原子の置換損傷を評価するための古典的な理論モデルです。

**特徴**:
- 入射粒子のエネルギーと材料の特性に基づいて、生成される置換原子の数を計算します
- 非熱的再結合を考慮しないため、実際の欠陥数よりも高い値を示す傾向があります
- 主に金属材料における放射線損傷の評価に広く用いられています
- 低エネルギー領域（10 MeV以下）では実験値と比較的良い一致を示します
- 高エネルギー領域（GeV領域）では実験値の約2倍を過大評価する傾向があります

**欠陥生成効率**: η ≈ 0.8（一般的な値）

#### ARCモデル（Athermal Recombination-Correctedモデル）

**定義**: NRTモデルの修正版で、非熱的再結合（athermal recombination）を考慮したモデルです。

**特徴**:
- 分子動力学法（MD）に基づく最新の材料損傷モデルです
- 放射線損傷後、生成された欠陥の一部が即座に再結合する効果を補正します
- NRTモデルより実際の欠陥数が少なくなる傾向があります
- より現実的な欠陥数密度を予測します
- 高エネルギー領域でも実験値と良い一致を示します
- 特に半導体材料や複雑な結晶構造を持つ材料における損傷評価に有用です

**欠陥生成効率**: η < 0.8（NRTより低い値、条件依存）

#### 半導体材料での比較

半導体材料におけるARCモデルとNRTモデルの比較では、以下のような傾向が報告されています：

- **シリコン（Si）**: ARCモデルはNRTモデルより約20-30%低い欠陥数密度を示します
- **GaAs**: ARCモデルはNRTモデルより約25-35%低い欠陥数密度を示します

**一般的な傾向**: ARC-DPA / NRT-DPA の比は、材料や照射条件によって異なりますが、一般的に0.3-0.8の範囲です。これは、ARCモデルが非熱的再結合を考慮することで、実際の欠陥数により近い値を予測するためです。

**注意**: 上記の数値は一般的な傾向であり、具体的な材料組成、照射エネルギー、温度などの条件によって異なります。実際の解析では、PHITSでNRT-DPAとARC-DPAの両方を計算し、比較することを推奨します。

**計算例（GaAs）**:

- DDD_mission = 1.0×10¹⁰ MeV/g
- ρ = 5.32 g/cm³
- Ed = 21.5 eV（Ga/Asの平均値）
- η = 0.8（NRTモデル）

```
DDD_J_g = 1.0×10¹⁰ × 1.602×10⁻¹³ = 1.602×10⁻³ [J/g]
Ed_J = 21.5 × 1.602×10⁻¹⁹ = 3.444×10⁻¹⁸ [J]
n_defects = 0.8 × (1.602×10⁻³ × 5.32) / (2 × 3.444×10⁻¹⁸)
          ≈ 9.9×10¹⁴ [cm⁻³]
```

**ARCモデルを使用する場合**（η = 0.6と仮定）:
```
n_defects = 0.6 × (1.602×10⁻³ × 5.32) / (2 × 3.444×10⁻¹⁸)
          ≈ 7.4×10¹⁴ [cm⁻³]
```

この例では、ARCモデルはNRTモデルより約25%低い欠陥数密度を示しています。

**注意**: この方法は近似であり、**DPAが利用可能な場合はDPAを優先**してください。化合物では元素別Edと`mother`パラメータで分解計算すると精度が上がります。

#### 参考文献

- **PHITSのARC-DPA実装**: PHITS v3.33以降でARC-DPA機能が実装されています。詳細はPHITS公式マニュアルを参照してください。
- **日本原子力研究開発機構の研究報告**: 鉄に対する陽子ビーム照射において、NRTモデルによる計算値は実験値の約2倍であるのに対し、ARCモデルは実験値と良い一致を示すことが報告されています（令和2年度 原子力システム研究開発事業 成果報告会）。
- **半導体材料での比較**: シリコンやGaAsなどの半導体材料におけるARC/NRT比較については、放射線損傷に関する専門的な文献を参照してください。

### 3.3 [T-DPA]セクションの基本設定

DPAを計算するには、`[T-DPA]`セクションを使用します：

```
[ T-DPA ]
mesh = reg              # 領域メッシュ
reg = 2 3 4 5 6         # 各層の領域番号
part = all              # 全粒子をタリー
axis = reg              # 領域ごとのDPAを出力
file = dpa.out          # 出力ファイル名
unit = 1                # DPA[x1.E-24/source]
output = dpa            # DPAの出力
idpa = 0                # NRT-dpa（非熱的再結合補正なし）
```

深さ方向（z方向）のDPA分布を取得する場合：

```
[ T-DPA ]
mesh = xyz               # xyzメッシュ
part = all
axis = z                # z方向の分布
file = dpa_z.out
unit = 1
output = dpa
idpa = 0
```

xyzメッシュの定義：

```
[ T-DPA ]
mesh = xyz
x-type = 1              # 線形メッシュ
x0 = -5.0               # x最小値 [cm]
x1 = 5.0                # x最大値 [cm]
nx = 1                  # x方向分割数
y-type = 1
y0 = -5.0
y1 = 5.0
ny = 1
z-type = 1              # z方向の深さ分布
z0 = -0.1               # z最小値 [cm]
z1 = 0.40               # z最大値 [cm]
nz = 50                 # z方向分割数（細かく分割）
```

**DPAの種類**:
- `idpa = 0`（デフォルト）: NRT-dpa（欠陥の非熱的再結合補正を考慮しない）
- `idpa = 1`: arc-dpa（欠陥の非熱的再結合補正を考慮する）

**単位の設定**:
- `unit = 1`: DPA[x1.E-24/source]（デフォルト）
- `unit = 2`: DPA[1/source]

## 4. per-source → 総フルエンス（cm⁻²）への規格化

PHITSの`[T-DPA]`/`[T-DDD]`は通常**per-source（1入射粒子あたり）**です。ミッション評価では、総フルエンス Φ_tot を掛けて：

```
DPA_mission = DPA_per_source × Φ_tot
DDD_mission = DDD_per_source × Φ_tot
```

と読み替えます。これはNRL-DDDやSPENVIS実装のDDD法と整合します。

### 4.1 計算例

**10 MeV陽子線、総フルエンス1e14 cm⁻²の場合**:

PHITS出力から得られたper-source値：
- DPA_per_source = 1.234×10⁻²⁴
- DDD_per_source = 0.1 MeV/g

**ミッション値への換算**:
```
DPA_mission = 1.234×10⁻²⁴ × 1×10¹⁴ = 1.234×10⁻¹⁰
DDD_mission = 0.1 × 1×10¹⁴ = 1×10¹³ MeV/g
```

このミッション値を使用して、セクション3で説明した方法で欠陥数密度を計算します。

## 5. SR-NIELによるクロスチェック

SR-NIEL計算機で材料（例：GaAs）に対するNIEL(E)を取得し、遮蔽後スペクトルで積分してDDDを作成します。PHITSの`ddd_layers.out`から得たDDD_missionと比較して、**Ed（はじき出ししきい値）**やhadronic寄与の扱いの妥当性を確認します。

### 5.1 III-V半導体での推奨値

- **GaAs**: Ga/As ≈ 21–22 eV（SR-NIEL/DLTS相関から推定）
- **AlInGaP**: Pは低Ed報告あり

### 5.2 比較手順と計算例

**手順**:
1. SR-NIEL計算機でGaAsのNIEL(E)を取得
2. 遮蔽後スペクトル（カバーガラス100 µm通過後）で積分
3. PHITSの`ddd_layers.out`から得たDDD_missionと比較

**期待される一致度**: 通常、数10%以内の一致が期待されます。一致しない場合は、Edやhadronic寄与の設定を見直してください。

**計算例（GaAs）**:

SR-NIELから得られたDDD（遮蔽後スペクトルで積分）：
- DDD_SR-NIEL = 9.5×10¹² MeV/g

PHITSから得られたDDD：
- DDD_PHITS = 1.0×10¹³ MeV/g

**比較**:
```
相対誤差 = |DDD_PHITS - DDD_SR-NIEL| / DDD_SR-NIEL × 100
        = |1.0×10¹³ - 9.5×10¹²| / 9.5×10¹² × 100
        ≈ 5.3%
```

この程度の一致度であれば、Ed設定（21.5 eV）は妥当と判断できます。

## 6. PHITS版差・ソース設定の注意

### 6.1 DPAモデルの違い

PHITSでは、`[T-DPA]`セクションで`model=NRT`と`model=ARC`を併記できます：

- **NRT-DPA**: 非熱的再結合補正を考慮しない標準的なDPA計算
- **ARC-DPA**: MD（分子動力学）に基づく非熱的再結合補正を考慮したDPA計算

**ARC-DPAはNRT-DPAより小さくなる傾向**があります（条件依存）。これは、高エネルギー衝突で生成された欠陥が非熱的に再結合する効果を考慮しているためです。条件によっては、ARC-DPAの方が実験値により近い結果を与える場合があります。

### 6.2 ソース設定の制約

**`s-type=26`（面源）の制約**:

- `cut`パラメータによる幾何制約があります
- 複数の円筒や球の併用はできません
- 円環などの複雑な形状には対応していません

**代替案**:
- 円環など複雑な形状が必要な場合は、`s-type=1`（点源）と`reg`パラメータの組み合わせを検討してください
- または、ユーザ定義ソースを使用してください

**注意**: 太陽電池の表面全体に均一に照射する場合は、`s-type=26`が適切です。ただし、照射領域を`cut`パラメータで正確に指定する必要があります。

### 6.3 PHITS v3.35の新機能

**`mother`パラメータによる元素別DPA出力**:

PHITS v3.35では、`[T-DPA]`セクションに`mother`パラメータが追加されました。これにより、化合物半導体（GaAs、InGaP等）での各元素別のDPAを直接出力できます。

**使用例**:

```
[ T-DPA ]
mesh = reg
reg = 102 103
part = all
axis = reg
file = dpa_gaas_element.out
mother = Ga As    # GaとAsの元素別DPAを出力
```

これは、化合物半導体での元素別の損傷評価に有用です。特に、各元素のはじき出ししきい値（Ed）が異なる場合の検証に適しています。

## 7. 完全な入力ファイル例

### 7.1 陽子線照射用入力ファイル

```
[ Title ]
Solar Cell Proton Irradiation DPA Analysis

[ Parameters ]
icntl = 0
maxcas = 1000000
itall = 0

[ Source ]
totfact = 1.0e10
<source> = 1.0
s-type = 26             # 面上分布ソース
suf = 1                 # 面番号1（カバーガラス上表面、照射面、z = -0.1 cm）
cut = 10 -11 20 -21     # 面上の領域制限（太陽電池の表面領域）
proj = proton           # 陽子
dir = 1.0               # 面の法線方向（垂直入射）
e-type = 0              # 単一エネルギー
eg0 = 10.0              # エネルギー [MeV]

[ Material ]
1  O  2
   Si  1
2  C  4
   H  6
   O  2
3  Si  3
   N  4
4  Si  1
5  Al  1

[ Surface ]
1  PZ  -0.1
2  PZ   0.0
3  PZ   0.05
4  PZ   0.06
5  PZ   0.36
6  PZ   0.40
10 PX  -5.0
11 PX   5.0
20 PY  -5.0
21 PY   5.0

[ Cell ]
1  0  0  -10 11 -20 21 -1 2
2  1  2.5  -10 11 -20 21 -1 2
3  2  0.95  -10 11 -20 21 2 3
4  3  3.1  -10 11 -20 21 3 4
5  4  2.33  -10 11 -20 21 4 5
6  5  2.7  -10 11 -20 21 5 6

[ T-DPA ]
mesh = xyz
part = all
axis = z
file = dpa_proton.out
unit = 1
output = dpa
idpa = 0
x-type = 1
x0 = -5.0
x1 = 5.0
nx = 1
y-type = 1
y0 = -5.0
y1 = 5.0
ny = 1
z-type = 1
z0 = -0.1
z1 = 0.40
nz = 50

[ END ]
```

### 7.2 電子線照射用入力ファイル

陽子線用の入力ファイルと同様ですが、[Source]セクションを以下のように変更：

```
[ Source ]
totfact = 1.0e10
<source> = 1.0
s-type = 26             # 面上分布ソース
suf = 1                 # 面番号1（カバーガラス上表面、照射面、z = -0.1 cm）
cut = 10 -11 20 -21     # 面上の領域制限（太陽電池の表面領域）
proj = electron         # 電子
dir = 1.0               # 面の法線方向（垂直入射）
e-type = 0              # 単一エネルギー
eg0 = 1.0               # エネルギー [MeV]
```

### 7.3 化合物半導体太陽電池の例（GaAs）

化合物半導体太陽電池（GaAs）の解析例を示します。GaAs太陽電池は、シリコン太陽電池と比較して以下の特徴があります：

- **材料組成**: GaAsは化合物半導体であり、Braggの規則に従ってPHITSで扱われます
- **はじき出ししきい値**: 化合物半導体では、各元素ごとにはじき出ししきい値（Ed）を設定する必要があります
- **構造**: SiO2カバー、GaAs層、Al電極の3層構造

#### GaAs太陽電池の構造

GaAs太陽電池の典型的な層構造：
1. **SiO2カバー層**（保護層、約100 µm）
2. **GaAs層**（バルク層、約300 µm）
3. **Al電極層**（バックコンタクト、約50 µm）

#### はじき出ししきい値（Ed）の設定

化合物半導体では、DPA計算の精度向上のため、各元素ごとにはじき出ししきい値（Ed）を設定します。PHITS 3.33以降では、**[edisp]セクション**を使用して各元素のはじき出ししきい値を設定できます。PHITS 3.35でもこの方法が使用可能です。

**設定方法**:

[edisp]セクションで、各元素のはじき出ししきい値（単位：eV）を設定します：

```
[ Edisp ]
# はじき出ししきい値（Ed）設定（PHITSのDPA/DDD機能で使用）
# GaAsの実効値：Ga/As ≈ 21–22 eV（SR-NIEL/DLTS相関）
Ed_Ga = 21.5 eV          # ガリウムのはじき出ししきい値
Ed_As = 21.5 eV          # ヒ素のはじき出ししきい値
Ed_Si = 21.0 eV          # シリコンのはじき出ししきい値（SiO2中Siの参考）
Ed_O  = 28.0 eV          # 酸素のはじき出ししきい値
Ed_Al = 25.0 eV          # アルミニウムのはじき出ししきい値
```

**パラメータの説明**:
- `Ed_元素名`: 各元素のはじき出ししきい値（単位：eV）
- 元素名は元素記号（Ga、As、Si、O、Alなど）を使用します
- 化合物半導体では、各元素ごとに異なる値を設定することで、DPA計算の精度が向上します

**はじき出ししきい値の推奨値**:
- **GaAs**: Ga ≈ 21–22 eV, As ≈ 21–22 eV（SR-NIEL/DLTS相関から推定）
- **Si**: 約21 eV（一般的な値）
- **O**: 約28 eV（酸化物中）
- **Al**: 約25 eV

**注意事項**:
- PHITSのバージョンによって、[edisp]セクションの記述方法が異なる場合があります
- 最新のPHITS公式マニュアルで、使用するバージョンでの設定方法を確認してください
- はじき出ししきい値は、実験データや文献値に基づいて設定することを推奨します

**注意**: 以下のコード例は、PHITSのバージョンや設定によってパラメータ名や記述方法が異なる場合があります。実際の使用時は、PHITS公式マニュアルを参照してください。

#### GaAs太陽電池用入力ファイル例

```
[ Title ]
GaAs Solar Cell Proton Irradiation DPA Analysis

[ Parameters ]
icntl = 0
maxcas = 100000          # 事象数
negs = 2                 # 電磁過程: EGS5を有効（PHITS 3.33+）

[ Material ]
1  O  2                  # SiO2カバーガラス
   Si  1
2  Ga  1                 # GaAs（化合物半導体）
   As  1
3  Al  1                 # アルミニウム電極

[ Edisp ]
# はじき出ししきい値（Ed）設定
Ed_Ga = 21.5 eV          # ガリウムのはじき出ししきい値
Ed_As = 21.5 eV          # ヒ素のはじき出ししきい値
Ed_Si = 21.0 eV          # シリコンのはじき出ししきい値
Ed_O  = 28.0 eV          # 酸素のはじき出ししきい値
Ed_Al = 25.0 eV          # アルミニウムのはじき出ししきい値

[ Surface ]
10  PZ  0.0              # GaAs層の開始面
11  PZ  0.01             # SiO2カバー層の厚み（100 µm = 0.01 cm）
12  PZ  0.04             # GaAs層の厚み（300 µm = 0.03 cm）+ カバー層
13  PZ  0.045            # Al電極層の厚み（50 µm = 0.005 cm）+ 上記
90  PX  -1.0             # x方向の境界
91  PX   1.0
92  PY  -1.0             # y方向の境界
93  PY   1.0
99  SO  100.0            # 外部境界（球）

[ Cell ]
101  1  2.20  -90 91 -92 93 -10 11    # SiO2カバー層（密度2.20 g/cm³）
102  2  5.32  -90 91 -92 93  11 12    # GaAs層（密度5.32 g/cm³）
103  3  2.70  -90 91 -92 93  12 13    # Al電極層（密度2.70 g/cm³）
998  0  0     -99 #101 #102 #103      # 外部真空領域

[ Source ]
totfact = 1.0e10
<source> = 1.0
s-type = 26             # 面上分布ソース
suf = 11                # 面番号11（SiO2カバー層上表面、z = 0.01 cmの面）
cut = 90 -91 92 -93     # 面上の領域制限（x: -1.0~1.0 cm, y: -1.0~1.0 cm）
proj = proton           # 陽子
dir = 1.0               # 面の法線方向（垂直入射）
e-type = 0              # 単一エネルギー
eg0 = 10.0              # エネルギー [MeV]

[ T-DPA ]
mesh = reg              # 領域メッシュ
reg = 101 102 103       # 各層の領域番号
part = all              # 全粒子をタリー
axis = reg              # 領域ごとのDPAを出力
file = dpa_gaas.out     # 出力ファイル名
unit = 1                # DPA[x1.E-24/source]
output = dpa            # DPAの出力
idpa = 0                # NRT-dpa（非熱的再結合補正なし）

[ T-DPA ]
mesh = reg              # ARC-dpaも計算
reg = 101 102 103
part = all
axis = reg
file = dpa_gaas_arc.out # ARC-dpa出力ファイル名
unit = 1
output = dpa
idpa = 1                # ARC-dpa（欠陥の非熱的再結合補正あり）

[ END ]
```

#### Si太陽電池とGaAs太陽電池の主な違い

| 項目 | Si太陽電池 | GaAs太陽電池 |
|------|-----------|-------------|
| **材料** | 単元素半導体（Si） | 化合物半導体（GaAs） |
| **密度** | 2.33 g/cm³ | 5.32 g/cm³ |
| **はじき出ししきい値** | デフォルト値を使用可能 | 各元素ごとに設定推奨（Ga: 21.5 eV, As: 21.5 eV） |
| **構造** | 5層構造（カバーガラス、EVA、SiNx、Si、Al） | 3層構造（SiO2、GaAs、Al） |
| **用途** | 地上用、宇宙用（低コスト） | 主に宇宙用（高効率） |

#### 化合物半導体での注意事項

1. **はじき出ししきい値の設定**: GaAsなどの化合物半導体では、各元素（Ga、As）ごとにはじき出ししきい値を設定することで、DPA計算の精度が向上します。PHITSのバージョンによって設定方法が異なる場合があります。

2. **材料定義**: 化合物半導体は、PHITSではBraggの規則に従って扱われます。各元素の組成比を正確に定義してください。

3. **密度の設定**: 化合物半導体の密度は、単元素半導体と比較して高い場合が多いです。正確な値を設定してください。

**注意**: 上記のコード例は参考用です。実際の使用時は、PHITS公式マニュアルを参照し、使用するPHITSのバージョンに合わせてパラメータを調整してください。

### 7.4 3接合太陽電池の例（InGaP/GaAs/Ge）

3接合太陽電池（Triple Junction solar cell）は、宇宙用太陽電池として広く使用されている高効率な太陽電池です。異なるバンドギャップを持つ3つの接合層を積層することで、太陽光スペクトルの広い範囲を効率的に変換できます。

**重要**: 以下のコード例は**サンプル**であり、実際の3接合太陽電池の構造とは厳密には異なります。実際のデバイスに合わせて層の厚さ、材料組成、密度などを調整する必要があります。

#### 3接合太陽電池の構造

典型的な3接合太陽電池の層構造：
1. **SiO2カバーガラス層**（保護層、約100 µm）
2. **InGaPトップセル層**（高バンドギャップ、約0.6 µm）
3. **GaAsミドルセル層**（中バンドギャップ、約3.0 µm）
4. **Geボトムセル層**（低バンドギャップ、基板、約150 µm）
5. **Alバックメタル層**（電極、約50 µm、オプション）

各接合層は異なる波長の光を吸収し、全体として高い変換効率を実現します。

#### InGaPの組成定義

InGaPなどの三元化合物半導体では、stoichiometryパラメータ（`sto`）を使用して組成比を定義します：

```
mat[2] InGaP 3                  # In0.49Ga0.51P（近似組成）
  Z=49  sto=0.49                # インジウム（原子番号49）
  Z=31  sto=0.51                # ガリウム（原子番号31）
  Z=15  sto=1.00                # リン（原子番号15）
```

**パラメータの説明**:
- `Z=元素の原子番号`: 元素を原子番号で指定
- `sto=組成比`: 各元素の組成比（stoichiometry）
- 組成比の合計は必ずしも1.0である必要はありませんが、実際の組成比を反映する必要があります

#### 3接合太陽電池用入力ファイル例

```
[ Title ]
Triple Junction Solar Cell Proton Irradiation DPA Analysis

[ Parameters ]
icntl = 0
maxcas = 200000          # 事象数（統計精度向上のため増やす）
negs = 2                 # 電磁過程: EGS5を有効（PHITS 3.33+）

[ Material ]
1  O  2                  # SiO2カバーガラス
   Si  1
2  InGaP 3               # In0.49Ga0.51P（近似組成）
  Z=49  sto=0.49         # インジウム
  Z=31  sto=0.51         # ガリウム
  Z=15  sto=1.00         # リン
3  Ga  1                 # GaAsミドルセル
   As  1
4  Ge  1                 # Geボトムセル（基板）
5  Al  1                 # アルミニウムバックメタル

[ Edisp ]
# はじき出ししきい値（Ed）設定
Ed_In = 43.0 eV          # インジウムのはじき出ししきい値
Ed_Ga = 21.5 eV          # ガリウムのはじき出ししきい値
Ed_P  = 21.0 eV          # リンのはじき出ししきい値
Ed_As = 21.5 eV          # ヒ素のはじき出ししきい値
Ed_Ge = 40.5 eV          # ゲルマニウムのはじき出ししきい値
Ed_Si = 21.0 eV          # シリコンのはじき出ししきい値
Ed_O  = 28.0 eV          # 酸素のはじき出ししきい値
Ed_Al = 25.0 eV          # アルミニウムのはじき出ししきい値

[ Surface ]
10  PZ  0.0              # 開始面
11  PZ  0.010            # SiO2カバー層の厚み（100 µm = 0.010 cm）
12  PZ  0.0106           # InGaP層の厚み（0.6 µm = 0.0006 cm）+ カバー層
13  PZ  0.0136           # GaAs層の厚み（3.0 µm = 0.003 cm）+ 上記
14  PZ  0.1636           # Ge層の厚み（150 µm = 0.15 cm）+ 上記
15  PZ  0.1686           # Al層の厚み（50 µm = 0.005 cm）+ 上記
90  PX  -0.5             # x方向の境界
91  PX   0.5
92  PY  -0.5             # y方向の境界
93  PY   0.5
99  SO  100.0            # 外部境界（球）

[ Cell ]
101  1  2.20  -90 91 -92 93 -10 11    # SiO2カバー層（密度2.20 g/cm³）
102  2  5.60  -90 91 -92 93  11 12    # InGaPトップセル（密度5.60 g/cm³）
103  3  5.32  -90 91 -92 93  12 13    # GaAsミドルセル（密度5.32 g/cm³）
104  4  5.32  -90 91 -92 93  13 14    # Geボトムセル（密度5.32 g/cm³）
105  5  2.70  -90 91 -92 93  14 15    # Alバックメタル（密度2.70 g/cm³）
998  0  0     -99 #101 #102 #103 #104 #105  # 外部真空領域

[ Source ]
totfact = 1.0e10
<source> = 1.0
s-type = 26             # 面上分布ソース
suf = 11                # 面番号11（SiO2カバー層上表面、z = 0.010 cmの面）
cut = 90 -91 92 -93     # 面上の領域制限（x: -0.5~0.5 cm, y: -0.5~0.5 cm）
proj = proton           # 陽子
dir = 1.0               # 面の法線方向（垂直入射）
e-type = 0              # 単一エネルギー
eg0 = 10.0              # エネルギー [MeV]

[ T-Track ]
file = flux_proton.out  # フラックス分布（確認用）
part = proton
mesh = xyz
x-type = 2
xmin = -0.1
xmax = 0.1
nx = 1
y-type = 2
ymin = -0.1
ymax = 0.1
ny = 1
z-type = 2              # 対数メッシュ
zmin = 0.0
zmax = 0.1686
nz = 400                # z方向を細かく分割
unit = 1                # FLUX [1/cm^2/source]

[ T-DPA ]
mesh = reg              # 領域メッシュ
reg = 101 102 103 104 105  # 各層の領域番号
part = all              # 全粒子をタリー
axis = reg              # 領域ごとのDPAを出力
file = dpa_tj_nrt.out   # NRT-dpa出力ファイル名
unit = 1                # DPA[x1.E-24/source]
output = dpa            # DPAの出力
idpa = 0                # NRT-dpa（非熱的再結合補正なし）

[ T-DPA ]
mesh = reg              # ARC-dpaも計算
reg = 101 102 103 104 105
part = all
axis = reg
file = dpa_tj_arc.out   # ARC-dpa出力ファイル名
unit = 1
output = dpa
idpa = 1                # ARC-dpa（欠陥の非熱的再結合補正あり）

[ END ]
```

#### 3接合太陽電池の特徴

1. **高効率**: 複数の接合層により、太陽光スペクトルの広い範囲を効率的に変換
2. **宇宙環境への適応**: 放射線耐性が高く、宇宙環境での長期使用に適している
3. **各接合層の役割**:
   - **InGaPトップセル**: 高エネルギー光（短波長）を吸収
   - **GaAsミドルセル**: 中エネルギー光（中波長）を吸収
   - **Geボトムセル**: 低エネルギー光（長波長）を吸収し、基板としても機能

#### DDD（Displacement Damage Dose）タリー

3接合太陽電池の解析では、DPAに加えて**DDD（Displacement Damage Dose）**も重要な指標です。DDDは、NIEL（Non-Ionizing Energy Loss）× フルエンスで定義され、太陽電池の性能劣化を評価する際に使用されます。

**注意**: 上記のコード例では[t-ddd]タリーの記述を含めていませんが、PHITSのバージョンによっては[t-ddd]セクションが使用可能な場合があります。詳細はPHITS公式マニュアルを参照してください。

#### サンプルコードに関する注意事項

**重要**: このコード例は**サンプル**であり、実際の3接合太陽電池の構造とは厳密には異なります。以下の点に注意してください：

1. **層の厚さ**: 実際のデバイスでは、各層の厚さは製造メーカーや用途によって異なります。実際のデバイス仕様に合わせて調整してください。

2. **材料組成**: InGaPの組成比（In0.49Ga0.51P）は近似値です。実際のデバイスでは、メーカーの仕様に合わせて正確な組成比を設定してください。

3. **密度**: 各材料の密度も実際のデバイスに合わせて調整が必要です。

4. **はじき出ししきい値**: [edisp]セクションで設定するはじき出ししきい値は、文献値や実験データに基づいて設定してください。

5. **その他の層**: 実際の3接合太陽電池には、トンネル接合層、バッファ層、ウィンドウ層など、ここに示していない層が含まれる場合があります。

実際の解析を行う際は、デバイスの詳細な構造情報を入手し、それに基づいて入力ファイルを作成してください。

## 8. 実行方法

### 8.1 コマンドライン実行

Windowsの場合：

```cmd
phits335win.exe < input.inp
```

Linux/Macの場合：

```bash
phits < input.inp
```

### 8.2 実行時の注意点

- 計算時間は、ヒストリー数（maxcas）と幾何学的構造の複雑さに依存します
- DPA計算は比較的時間がかかる場合があります
- 統計誤差を小さくするため、十分なヒストリー数を設定してください

## 9. 結果の解析

### 9.1 出力ファイルの読み方

DPAタリーの出力ファイル（例：`dpa_proton.out`）には以下の情報が含まれます：

1. **インプットエコー**: 入力パラメータの再出力
2. **タリー結果**: 各メッシュのDPA値と統計誤差
3. **グラフ情報**: ANGELで可視化するための情報

### 9.2 層ごとのDPA取得

`axis = reg`で領域メッシュを使用した場合、各層（領域）ごとの平均DPAが出力されます。

### 9.3 深さ方向のDPA分布

`axis = z`でxyzメッシュを使用した場合、深さ方向（z方向）のDPA分布が出力されます。これにより、各層でのDPAの変化を確認できます。

### 9.4 可視化

PHITS付属のANGELを使用して結果を可視化できます：

```bash
angel dpa_proton.out
```

または、出力ファイルを直接ANGELで開きます。

## 10. トラブルシューティング

### 10.1 計算が収束しない場合

- ヒストリー数（maxcas）を増やしてください
- 統計誤差が大きい場合は、より多くのヒストリー数を設定してください

### 10.2 結果が異常な値になる場合

- 幾何学的構造の定義を確認してください（面の符号、領域定義）
- 線源の位置と方向を確認してください
- 材料の密度と組成を確認してください

### 10.3 メモリ不足エラー

- メッシュの分割数を減らしてください
- 計算する領域を限定してください

### 10.4 DPA値が0になる場合

- 線源粒子が対象領域に到達しているか確認してください
- エネルギーが低すぎて領域に到達していない可能性があります
- 線源の位置と方向を確認してください

## 11. 参考資料

### 11.1 PHITS公式サイト

- [PHITS公式サイト](https://phits.jaea.go.jp/indexj.html)
- [PHITSユーザーズマニュアル](https://phits.jaea.go.jp/manual/manualJ-html/index.html)

### 11.2 関連するマニュアルセクション

- [T-DPA]セクション: 7.10節
- [Source]セクション: 5.3節
- [Material]セクション: 5.4節
- [Cell]セクション: 5.6節
- [Surface]セクション: 5.5節

### 11.3 引用文献

PHITSを使用した論文を作成する際の引用文献については、[13.3節](#133-引用文献)を参照してください。

## 12. 補足情報

### 12.1 層の厚さの調整

実際の太陽電池の層構造に合わせて、各層の厚さを調整してください。本マニュアルの例は一般的な値を使用していますが、実際のデバイスに合わせて変更が必要です。

### 12.2 材料組成の詳細

より正確な解析を行うため、実際の材料組成を調べて[Material]セクションで正確に定義してください。

### 12.3 複数エネルギーでの解析

異なるエネルギーの陽子線・電子線での解析を行う場合、各エネルギーごとに計算を実行し、結果を比較してください。

### 12.4 フルエンス依存性

異なるフルエンスでの解析を行う場合、`totfact`パラメータを変更して計算を実行してください。

## 13. ライセンスとクレジット

### 13.1 本マニュアルのライセンス

本マニュアルは、MIT Licenseの下で公開されています。詳細は[LICENSE](LICENSE)ファイルをご参照ください。

### 13.2 PHITSに関するクレジット

本マニュアルは、**日本原子力研究開発機構（JAEA）**が開発した**PHITS（Particle and Heavy Ion Transport code System）**を使用するためのガイドです。

- **PHITS公式サイト**: https://phits.jaea.go.jp/indexj.html
- **PHITSユーザーズマニュアル**: https://phits.jaea.go.jp/manual/manualJ-html/index.html

PHITSの利用には、JAEAが定める利用規約が適用されます。PHITSを使用するには、公式サイトでのユーザー登録が必要です。詳細はPHITS公式サイトをご確認ください。

### 13.3 引用文献

PHITSを使用した研究や成果を発表する際は、以下の文献を引用してください：

**PHITSコードの引用文献**:
- T. Sato, Y. Iwamoto, S. Hashimoto, T. Ogawa, T. Furuta, S. Abe, T. Kai, Y. Matsuya, N. Matsuda, Y. Hirata, T. Sekikawa, L. Yao, P.E. Tsai, H.N. Ratliff, H. Iwase, Y. Sakaki, K. Sugihara, N. Shigyo, L. Sihver and K. Niita, "Recent improvements of the Particle and Heavy Ion Transport code System - PHITS version 3.33," J. Nucl. Sci. Technol. 61, 127-135 (2024). [オープンアクセス]

**PHITSの精度に関するベンチマーク文献**:
- Y. Iwamoto, S. Hashimoto, T. Sato, N. Matsuda, S. Kunieda, Y. Çelik, N. Furutachi and K. Niita, "Benchmark study of particle and heavy-ion transport code system using shielding integral benchmark archive and database for accelerator-shielding experiments," J. Nucl. Sci. Technol. 59, 665-675 (2022). [オープンアクセス]

### 13.4 注意事項

- **PHITSの利用規約**: PHITSの利用には、JAEAが定める利用規約が適用されます。PHITS公式サイトで最新の利用規約を確認し、遵守してください。
- **バージョン情報**: 本マニュアルはPHITS ver. 3.35を基準に作成されています。他のバージョンでは一部パラメータが異なる場合があります。最新のマニュアルを参照してください。
- **本マニュアルの内容**: 本マニュアルの内容は、PHITS公式マニュアル（manualJ-phits.pdf）を参考に作成されています。より詳細な情報や最新の機能については、PHITS公式マニュアルを参照してください。
- **保証**: 本マニュアルの内容について、正確性や完全性を保証するものではありません。実際の計算を行う際は、PHITS公式マニュアルを参照し、適切な設定を行ってください。

### 13.5 貢献

本マニュアルの改善提案やバグ報告は、GitHubのIssuesまたはPull Requestsでお願いします。

貢献方法の詳細については、[CONTRIBUTING.md](CONTRIBUTING.md)をご参照ください。

---

**注意**: 本マニュアルはPHITS ver. 3.35を基準に作成されています。他のバージョンでは一部パラメータが異なる場合があります。最新のマニュアルを参照してください。

